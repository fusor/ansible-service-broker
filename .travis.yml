language: go
go:
  - "1.9.x"
dist: trusty
sudo: required
group: edge
env:
  - CHANGE_MINIKUBE_NONE_USER=true

jobs:
  include:
    - stage: "Format"
      script:
        - ./scripts/travis.sh format
    - stage: "Vet"
      script:
        - ./scripts/travis.sh vet
    - stage: "Lint"
      script:
        - ./scripts/travis.sh lint
    - stage: "Build"
      script:
        - ./scripts/travis.sh build
    - stage: "Test"
      script:
        - ./scripts/travis.sh build

    - stage: "OpenShift CI"
      before_install:
        - ./scripts/travis.sh docs; if [ $? -eq 9 ]; then exit 0; fi
        - ./scripts/travis.sh before_install
      install:
        - ./scripts/travis.sh install
      before_script:
        - ./scripts/travis.sh before_script
        - ./scripts/travis.sh setup-cluster
        - ./scripts/travis.sh setup-broker
      script:
        - ./scripts/travis.sh ci
        - ./scripts/broker-ci/gather-logs.sh
    - stage: "Kubernetes CI"
      before_install:
        - ./scripts/travis.sh docs; if [ $? -eq 9 ]; then exit 0; fi
      before_script:
        - ./scripts/travis.sh setup-minikube
        - ./scripts/travis.sh k8s-catalog
        - ./scripts/travis.sh pv-setup
        - ./scripts/travis.sh k8s-broker
      script:
        - ./scripts/travis.sh k8s-ci
        - ./scripts/broker-ci/gather-logs.sh
