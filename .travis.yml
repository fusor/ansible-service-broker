language: go
go:
  - "1.7.x"
dist: trusty
sudo: required
group: edge

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y python-apt autoconf pkg-config e2fslibs-dev libblkid-dev zlib1g-dev liblzo2-dev asciidoc
install:
  - sudo pip install ansible==2.3.1 docker-py
  - ./scripts/travis.sh install
before_script:
  - tmp=`mktemp`
  - echo '{"insecure-registries":["172.30.0.0/16"]}' > ${tmp}
  - sudo mv ${tmp} /etc/docker/daemon.json
  - sudo mount --make-shared /
  - sudo service docker restart
script:
  - ./scripts/travis.sh format
  - ./scripts/travis.sh vet
  - ./scripts/travis.sh lint
  - ./scripts/travis.sh build
  - ./scripts/travis.sh test
  - ./scripts/travis.sh ci
  - oc cluster up --image=docker.io/openshift/origin --version=v3.6.0-rc.0 --service-catalog=true
  - oc login -u system:admin
  - make build-image
  - make deploy
  - oc get pods --all-namespaces
  - sleep 15
  - oc logs $(oc get pods -o name -l service=asb | cut -f 2 -d '/')
